<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="view_picking_form_inherit" model="ir.ui.view">
            <field name="name">stock picking inherit</field>
            <field name="model">stock.picking</field>
            <field name="priority">11</field>
            <field name="inherit_id" ref="stock.view_picking_form" />
            <field name="arch" type="xml">
                <xpath expr="//button[6]" position="attributes">
                    <attribute name="attrs">{'invisible': ['|','|','|',('state', '!=', 'done'), ('is_locked', '=', False), ('ban_giao_or_nghiem_thu', '=', 'HUY'),('is_quyen_chuyen_tiep','=',False)]}</attribute>
                </xpath>
                <xpath expr="//button[5]" position="after">
                    <button name="validate_cua_ben_giao" attrs="{'invisible': [('show_validate_ben_giao', '=', False)]}" string="Xác nhận ben giao" groups="stock.group_stock_user" type="object" class="oe_highlight" />
                    <button name="%(stock.act_stock_return_picking)d" string="Hủy biên bản" context="{'default_loai_tra_hay_chuyen_tiep':'tra_do_huy','tra_do_huy_for_readonly':True}" attrs="{'invisible': ['|','|','|', ('state', '!=', 'done'), ('is_locked', '=', False),('ban_giao_or_nghiem_thu', '=', 'HUY'),('is_quyen_huy_bb','=',False)]}" type="action" groups="base.group_user" class="btn-danger" />
                    <button name="%(stock.act_stock_return_picking)d" string="Chuyển tiếp" context="{'default_loai_tra_hay_chuyen_tiep':'chuyen_tiep'}" attrs="{'invisible': ['|','|','|',('state', '!=', 'done'), ('is_locked', '=', False), ('ban_giao_or_nghiem_thu', '=', 'HUY'),('is_quyen_chuyen_tiep','=',False)]}" type="action" groups="base.group_user" class="btn-primary" />
                </xpath>
                <xpath expr="//button[@name='action_confirm']" position="attributes">
                    <attribute name="groups">base.group_erp_manager</attribute>
                </xpath>
                <xpath expr="//button[@name='action_confirm']" position="attributes">
                    <attribute name="groups">base.group_erp_manager</attribute>
                </xpath>
                <xpath expr="//button[5]" position="attributes">
                    <attribute name="invisible">True</attribute>
                </xpath>
                <xpath expr="//button[@name='action_cancel']" position="attributes">
                    <attribute name="groups">base.group_erp_manager</attribute>
                </xpath>
                <xpath expr="//button[@name='action_assign']" position="attributes">
                    <attribute name="groups">base.group_erp_manager</attribute>
                </xpath>
                <xpath expr="//button[@name='action_toggle_is_locked']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='button_scrap']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='do_unreserve']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='do_print_picking']" position="replace"></xpath>
                <xpath expr="//button[@name='action_toggle_is_locked']" position="after">
                    <!-- 
                    <button name="ghom_stock_move_lines" string="Tạo Bản In" type="object" />
                    <button name="xem_print_theo_move_line" string="Xem biên bản html" type="object" class="btn-primary" />
                    <button name="xem_print_pdf" string="Xem biên bản pdf" type="object" />
                    -->
                    <button name="download_xl_bbbg" string="Download BBBG Excel " type="object" class="btn-primary" />
                </xpath>
                <field name="location_id" position="replace">
                    <field name="id" />
                    <field name="location_id" domain="['|',('cho_phep_khac_tram_chon','=', True),'&amp;',('is_kho_cha','=',True),('department_id','=', department_id)]" />
                    <field name="department_id" />
                    <field name="noi_ban_giao" />
                    <field name="stt_trong_bien_ban_in" readonly="0" />
                    <field name="texttemplate_id" context="{'default_field_context':'tonkho.stock.picking.field.ly_do'}" />
                </field>
                <field name="origin" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="partner_id" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                
                
                
                
                <field name="scheduled_date" position="replace">
                    <field name="date"  attrs="{'readonly':False}"/> <!--  invisible="1" cái này xài không được -->
                    <field name="choosed_stock_quants_ids" invisible="1">
                        <tree>
                            <field name="id"></field>
                        </tree>
                    </field>
                </field>
                <field name="location_dest_id" position="replace" />
                <field name="origin" position="before">
                    <field name="show_validate_ben_giao" invisible="1"></field>
                    <field name="location_dest_id" domain="['|',('cho_phep_khac_tram_chon','=', True), '&amp;',('is_kho_cha','=',True),'&amp;',('usage','=','internal'),'|',('name','not ilike','Đang chạy'),('department_id','=', department_id)]" />
                    <field name="ban_giao_or_nghiem_thu" />
                    <field name="ma_bien_ban" readonly="0" />
                    <field name="totrinh_id" />
                    <field name="ly_do" />
                    <field name="is_quyen_chuyen_tiep" invisible="1" />
                    <field name="is_quyen_huy_bb" invisible="1" />
                </field>
                <xpath expr="//page[1]" position="attributes">
                    <attribute name="attrs">{'invisible': False}</attribute>
                </xpath>
                <xpath expr="//page[1]/field[@name='move_line_ids']" position="attributes">
                    <attribute name="attrs">{}</attribute>
                    <attribute name="context">{'default_picking_id': id, 'default_location_id': location_id, 'default_location_dest_id': location_dest_id,'ban_giao_or_nghiem_thu':ban_giao_or_nghiem_thu}</attribute>
                </xpath>
                <xpath expr="//page[1]/field/tree" position="attributes">
                    <attribute name="class">d4tree</attribute>
                </xpath>
                <xpath expr="//page[1]/field/tree/field[@name='product_uom_qty']" position="attributes">
                    <attribute name="groups">base.group_erp_manager</attribute>
                </xpath>
                <xpath expr="//page[1]/field/tree/field[@name='product_id']" position="attributes">
                    <attribute name="attrs">{'readonly': [('parent.state', 'in', ('cancel','done'))]}</attribute>
                </xpath>
                <xpath expr="//page[1]/field/tree/field[@name='location_id']" position="attributes">
                    <attribute name="attrs">{}</attribute>
                </xpath>
                <xpath expr="//page[1]/field/tree/field[@name='location_dest_id']" position="attributes">
                    <attribute name="attrs">{'readonly': ['|',('in_entire_package', '=', True),('state', 'in', ('done', 'cancel'))]}</attribute>
                </xpath>
               
               <!--  cái này có dư khong
                <xpath expr="//page[1]/field/tree/field[@name='lot_id']" position="attributes">
                    <attribute name="attrs">{'column_invisible': [('parent.show_lots_text', '=', True)], 'invisible': [('lots_visible', '=', False)], 'readonly': ['|',('in_entire_package', '=', True),('state', 'in', ('done', 'cancel'))]}</attribute>
                </xpath>
                 -->
                
                <xpath expr="//page[1]/field/tree/field[@name='qty_done']" position="attributes">
                    <attribute name="attrs">{'readonly': [('state', 'in', ('done', 'cancel'))]}</attribute>
                </xpath>
                <xpath expr="//page[1]/field/tree/field[@name='product_id']" position="before">
                    <field name="stock_quant_id" domain="[('location_id','child_of',parent.location_id),('quantity','&gt;',0)]" context="{'kho_da_chon':parent.choosed_stock_quants_ids}" attrs="{'readonly': [('state', 'in', ('done', 'cancel'))]}" />
                </xpath>
                <xpath expr="//page[1]/field/tree/field[@name='lot_id']" position="replace"></xpath>
                <field name="product_uom_id" force_save="1" readonly="1" groups="product.group_uom" />
                <xpath expr="//page[1]/field/tree/field[@name='product_uom_id']" position="after">
                    <field name="tracking" readonly="1"></field>
                    <field name="lot_id" invisible="0" attrs="{'column_invisible': [('parent.show_lots_text', '=', True)],                     'invisible': ['|',('lots_visible', '=', False),('tracking', '=', 'none')],                                'readonly': ['|',('in_entire_package', '=', True),                 ('state', 'in', ('done', 'cancel'))]}" groups="stock.group_production_lot" domain="[('product_id', '=', product_id)]" context="{'default_product_id': product_id, 'default_pn_id': pn_id,'pn_id_readonly':True}" />
                    <field name="tinh_trang" attrs="{'readonly': [('state', 'in', ('done','cancel'))]}"></field>
                    <field name="ghi_chu"></field>
                    <field name="stt"></field>
                    <field name="ghi_chu_cate"></field>
                    
                </xpath>
                <xpath expr="//page[1]/field/tree/field[@name='lot_id']" position="attributes">
                    <attribute name="string">Serial number</attribute>
                </xpath>
                <xpath expr="//page[1]/field/tree/field[@name='product_uom_qty']" position="attributes"></xpath>
                <xpath expr="//page[2]" position="attributes">
                    <attribute name="groups">base.group_erp_manager</attribute>
                </xpath>
                <xpath expr="//page[3]" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//page[2]/field[@name='move_lines']" position="attributes">
                    <attribute name="attrs">{}</attribute>
                </xpath>
                <xpath expr="//page[2]/field/tree/field[@name='reserved_availability']" position="attributes">
                    <attribute name="groups">base.group_erp_manager</attribute>
                </xpath>
                <xpath expr="//page[1]/field/tree/field[@name='lot_id']" position="before">
                    <!--  <field name="pn" attrs="{'invisible': [('tracking', '=', 'none')],'readonly': [('state', 'in', ('done', 'cancel'))]}"></field> -->
                    <field name="pn_id" attrs="{'readonly': [('state', 'in', ('done', 'cancel'))]}" context="{'default_product_id':product_id}" domain="[('product_id','=',product_id)]"></field><!-- 'invisible': [('tracking', '=', 'none')], -->
                    <field name="id"></field>
                </xpath>
                <xpath expr="//page[1]/field/tree/field[@name='state']" position="attributes">
                    <attribute name="invisible">0</attribute>
                </xpath>
                <xpath expr="//page[2]/field/tree/field[@name='state']" position="attributes">
                    <attribute name="invisible">0</attribute>
                </xpath>
                <xpath expr="//page[2]/field/tree/field[@name='quantity_done']" position="attributes">
                    <attribute name="readonly">0</attribute>
                </xpath>
                <xpath expr="//page[2]/field/tree/field[@name='state']" position="after">
                    <field name="move_orig_ids"></field>
                    <field name="move_dest_ids"></field>
                </xpath>
                <xpath expr="//page[2]/field/tree/field[@name='product_uom']" position="after">
                    <field name="ghi_chu"></field>
                   
                    <field name="id"></field>
                </xpath>
                <xpath expr="//page[2]/field/tree/field[@name='product_uom_qty']" position="attributes">
                    <attribute name="attrs">{}</attribute>
                </xpath>
                <xpath expr="//page[3]" position="after">
                    <page string="Thông tin thêm">
                        <group>
                            <group>
                                <field name="source_member_ids">
                                    <tree editable="bottom">
                                        <field name="name" />
                                        <field name="department_id" />
                                        <field name="job_id" string="Chức vụ" />
                                        <field name="parent_id" />
                                    </tree>
                                </field>
                                <field name="title_ben_thu_3" />
                                <field name="ben_thu_3_ids">
                                    <tree>
                                        <field name="name" />
                                        <field name="department_id" />
                                        <field name="job_id" string="Chức vụ" />
                                        <field name="parent_id" />
                                    </tree>
                                </field>
                                <field name="ben_giao_giu" />
                            </group>
                            <group>
                                <field name="dest_member_ids">
                                    <tree>
                                        <field name="name" />
                                        <field name="department_id" />
                                        <field name="job_id" string="Chức vụ" />
                                        <field name="parent_id" />
                                    </tree>
                                </field>
                                <field name="title_ben_thu_4" />
                                <field name="ben_thu_4_ids">
                                    <tree>
                                        <field name="name" />
                                        <field name="department_id" />
                                        <field name="job_id" string="Chức vụ" />
                                        <field name="parent_id" />
                                    </tree>
                                </field>
                                <field name="ben_nhan_giu" />
                            </group>
                            <group>
                                <field name="so_ban_in" />
                            </group>
                        </group>
                        <group>
                            <field name="is_not_show_y_kien_ld" />
                            <field name="lanh_dao_id" />
                            <!-- <field name="is_chia_2_dong"/> -->
                        </group>
                    </page>
                    <page string="Thông tin về Download File">
                        <header>
                            <button name="import_file" string="import_file" type="object" />
                            <button name="check_file" string="check_file" type="object" class="btn-primary" />
                        </header>
                        <group>
                            <group>
                            <field name="is_dl_right_now" />
                            <field name="is_ghom_tot" />
                            <field name="is_set_tt_col" />
                            <field name="allow_cate_for_ghi_chu" />
                            </group>
                            <group>
                            <field name="file" filename="filename" />
                            <field name="filename" invisible="1" />
                            <field name="file_dl" readonly="1" filename="file_dl_name" />
                            <field name="file_dl_name" invisible="1" />
                            <field name="log" groups="base.group_erp_manager" />
                            </group>
                            <field name="file_ids"></field>
                        </group>
                    </page>
                    <page string="Thông tin trả vật tư">
                        <group>
                            <field name="origin_pick_id"></field>
                            <field name="loai_tra_hay_chuyen_tiep" />
                            <field name="ten_truoc_huy" />
                        </group>
                    </page>
                </xpath>
            </field>
        </record>
        <!-- TREE -->
        <record id="cb_vpicktree_inherit" model="ir.ui.view">
            <field name="name">stock.picking.tree_inherit</field>
            <field name="model">stock.picking</field>
            <field name="inherit_id" ref="stock.vpicktree" />
            <field name="arch" type="xml">
               
               
               <tree position="attributes">
                    <attribute name="decoration-danger">ma_bien_ban=='HUY'</attribute>
                    <attribute name="decoration-info">ma_bien_ban=='TRA_DO_HUY'</attribute>
                </tree>
                
                
                <field name="scheduled_date" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="scheduled_date" position="before">
                    
                    <field name="id" />
                    <field name="ly_do" />
                    <field name="ma_bien_ban" />
					<field name="department_id" />
					<field name="file"/>
                </field>
                <!-- 
                <xpath expr="//field[@name='location_dest_id']" position="before">
                    <field name="department_id" />
                    <field name="loai_tra_hay_chuyen_tiep" />
                    <field name="origin_pick_id" />
                    <field name="location_id" />
                </xpath>
                 -->
                <xpath expr="//field[@name='location_dest_id']" position="before">
            		<field name="date" string="Ngày biên bản" />
                    <field name="location_id" />
                </xpath>
                  <xpath expr="//field[@name='location_dest_id']" position="after">
			                    <field name="loai_tra_hay_chuyen_tiep" />
			                    <field name="origin_pick_id" />
                     </xpath>
                        
                <field name="backorder_id" position="replace" />
                <field name="partner_id" position="replace" />
                <field name="origin" position="replace" />
            </field>
        </record>
   
        <!--! TREE -->
        <!-- SEARCH -->
        
          
        
        <record id="view_picking_internal_search" model="ir.ui.view">
            <field name="name">stock.picking.internal.search</field>
            <field name="model">stock.picking</field>
            <field name="inherit_id" ref="stock.view_picking_internal_search" />
            <field name="arch" type="xml">
                <field name="product_id" position="after">
                    <field name="location_id" />
                    <filter name="loc_khong_phai_huy" string="Không Hủy" domain="[('ban_giao_or_nghiem_thu','not in',['HUY'])]"></filter>
                    <separator />
                    <filter name="loc_khong_phai_tra_do_huy" string="Không Trả do Hủy" domain="[('ban_giao_or_nghiem_thu','not in',['TRA_DO_HUY'])]"></filter>
             		 <separator />
                  	<filter name="recently" string="Thay đổi gần đây" domain="[('write_date','&gt;', (datetime.datetime.now() - datetime.timedelta(hours=7,minutes=5)).strftime('%Y-%%m-%%d %%H:%%M:%%S'))]" help="Pickings that are late on scheduled time" />
                  	<filter name="today" string="Thay đổi trong ngày" domain="[('write_date','&gt;=', (datetime.datetime.now().replace(hour=0,minute=0,second=0) - datetime.timedelta(hours=7)).strftime('%Y-%m-%d %H:%M:%S'))]" help="Pickings that are late on scheduled time" />
                    <filter name="this month" string="Thay đổi tháng này" domain="[('write_date','&gt;=',(datetime.datetime.now().replace(day=1,hour=0,minute=0,second=0)-datetime.timedelta(hours=7)).strftime('%Y-%%m-%%d %%H:%%M:%%S'))]" help="Chọn tháng này" />
                   <!--   <filter name="last month" string="Thay đổi tháng trước" domain="[('write_date','&gt;=',(datetime.datetime.now().replace(day=1,hour=0,minute=0,second=0)-datetime.timedelta(months=1,hours=7)).strftime('%Y-%m-%d %H:%M:%S')),('write_date','&lt;',(datetime.datetime.now().replace(day=1,hour=0,minute=0,second=0)-datetime.timedelta(hours=7)).strftime('%Y-%m-%d %H:%M:%S'))]" help="Chọn tháng này" />-->
                   <!-- <filter name="last month" string="CV Tháng Trước" domain="[('write_date','&gt;=',(datetime.datetime.now().replace(day=1,hour=0,minute=0,second=0) +relativedelta(months=-1) - datetime.timedelta(hours=7) ).strftime('%Y-%m-%d %H:%M:%S '))]" help="Chọn tháng này" /> -->  
                </field>
            </field>
        </record>
        <record id="stock.action_picking_tree_all" model="ir.actions.act_window">
         
        </record>
        
        
        <record id="view_picking_internal_search_tonkho" model="ir.ui.view">
            <field name="name">stock.picking.internal.search</field>
            <field name="model">stock.picking</field>
            <field name="arch" type="xml">
                <search string="Picking Lists">
                    <field name="name" string="tên" filter_domain="['|',('name','ilike', self),('origin','ilike',self)]"/>
                    <field name="product_id"/>
                    <filter name="draft" string="Draft" domain="[('state','=','draft')]" help="Draft Moves"/>
                   <!-- 
                    <filter name="available" string="Ready" domain="[('state','in',('assigned', 'partially_available'))]" help="Assigned Moves"/>
                    <filter name="waiting" string="Waiting Availability" domain="[('state','in', ('confirmed', 'waiting'))]" help="Waiting Moves"/>
                    <filter name="confirmed" string="Confirmed" domain="[('state','in', ('confirmed', 'waiting', 'assigned'))]" help="Confirmed Moves"/>
                    -->
                    <filter name="done" string="Done" domain="[('state','=','done')]" help="Pickings already processed"/>
                    <separator/>
                     <!-- 
                    <filter name="late" string="Late" domain="[('scheduled_date','&lt;', time.strftime('%%Y-%%m-%%d %%H:%%M:%%S'))]" help="Pickings that are late on scheduled time"/>
                    <separator/>
                   
                    <filter name="backorder" string="Backorders" domain="[('backorder_id','!=', False)]" help="Remaining parts of picking partially processed"/>
                    <separator/>
                    <filter string="My Activities" name="activities_my"
                        domain="[('activity_ids.user_id', '=', uid)]"/>
                    <separator/>
                    <filter string="Late Activities" name="activities_overdue"
                        domain="[('activity_ids.date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]"
                        help="Show all records which has next action date is before today"/>
                    <filter string="Today Activities" name="activities_today"
                        domain="[('activity_ids.date_deadline', '=', context_today().strftime('%Y-%m-%d'))]"/>
                    <filter string="Future Activities" name="activities_upcoming_all"
                        domain="[('activity_ids.date_deadline', '&gt;', context_today().strftime('%Y-%m-%d'))
                        ]"/>
                    <field name="partner_id" filter_domain="[('partner_id','child_of',self)]"/>
                  
                    <field name="product_id"/>
                    
                    <field name="picking_type_id"/>
                     -->
                     
                     <field name="location_id" />
                     <separator />
                    <filter name="loc_khong_phai_huy" string="Không hiển thị BB hủy" domain="[('ban_giao_or_nghiem_thu','not in',['HUY']),('ban_giao_or_nghiem_thu','not in',['TRA_DO_HUY'])]"></filter>
                    <!-- 
                    <filter name="loc_khong_phai_tra_do_huy" string="Không hiển thị BB Trả do Hủy" domain="[('ban_giao_or_nghiem_thu','not in',['TRA_DO_HUY'])]"></filter>
             		 <separator />
             		  -->
                  	<filter name="recently" string="Thay đổi gần đây" domain="[('write_date','&gt;', (datetime.datetime.now() - datetime.timedelta(hours=7,minutes=5)).strftime('%Y-%%m-%%d %%H:%%M:%%S'))]" help="Pickings that are late on scheduled time" />
                  	<filter name="today" string="Thay đổi trong ngày" domain="[('write_date','&gt;=', (datetime.datetime.now().replace(hour=0,minute=0,second=0) - datetime.timedelta(hours=7)).strftime('%Y-%m-%d %H:%M:%S'))]" help="Pickings that are late on scheduled time" />
                    <filter name="this month" string="Thay đổi tháng này" domain="[('write_date','&gt;=',(datetime.datetime.now().replace(day=1,hour=0,minute=0,second=0)-datetime.timedelta(hours=7)).strftime('%Y-%%m-%%d %%H:%%M:%%S'))]" help="Chọn tháng này" />
                    
                    
                    
                    <group expand="0" string="Group By">
                        <filter string="Status" domain="[]" context="{'group_by':'state'}"/>
                      <!-- 
                        <filter string="Order Date" domain="[]"  context="{'group_by':'date'}"/>
                        <filter string="Expected Date" domain="[]"  context="{'group_by':'scheduled_date'}"/>
                        <filter string="Origin" domain="[]" context="{'group_by':'origin'}"/>
                        <filter name="picking_type" string="Operation Type" domain="[]" context="{'group_by':'picking_type_id'}"/>
                        <filter string="Procurement Group" domain="[]" context="{'group_by':'group_id'}"/>
                    -->
                    </group>
                </search>
            </field>
        </record>
        
        <record id="stock.action_picking_tree_all" model="ir.actions.act_window">
        	 <field name="search_view_id" ref="view_picking_internal_search_tonkho"/>
        	   <field name="context">{
                    'contact_display': 'partner_address','search_default_loc_khong_phai_huy':1
            }
            </field>
        </record>
        
       <!-- <menuitem id="stock.menu_stock_inventory_control" name="Master Data" parent="stock.menu_stock_root" sequence="1"/>
         --> 
          <menuitem name="Inventory" id="stock.menu_stock_root" sequence="1"
        groups="stock.group_stock_manager,stock.group_stock_user"
        web_icon="stock,static/description/icon.png"/>
    </data>
</odoo>